<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewModels="clr-namespace:dxfInspect.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="dxfInspect.Views.DxfMainView"
             x:CompileBindings="True" x:DataType="viewModels:DxfViewerViewModel">

  <UserControl.Styles>
    <!-- Modern Button Style -->
    <Style Selector="Button">
      <Setter Property="Background" Value="#f0f0f0" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="Padding" Value="12,8" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="MinWidth" Value="100" />
      <Setter Property="HorizontalContentAlignment" Value="Center" />
      <Setter Property="Transitions">
        <Transitions>
          <BrushTransition Property="Background" Duration="0:0:0.2" />
          <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.1" />
        </Transitions>
      </Setter>
    </Style>
    <Style Selector="Button:pointerover">
      <Setter Property="Background" Value="#e0e0e0" />
      <Setter Property="RenderTransform" Value="scale(1.02)" />
    </Style>
    <Style Selector="Button:pressed">
      <Setter Property="Background" Value="#d0d0d0" />
      <Setter Property="RenderTransform" Value="scale(0.98)" />
    </Style>

    <!-- Modern TextBox Style -->
    <Style Selector="TextBox">
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="BorderBrush" Value="#20000000" />
      <Setter Property="Padding" Value="8,6" />
      <Setter Property="MinHeight" Value="32" />
    </Style>

    <!-- Modern NumericUpDown Style -->
    <Style Selector="NumericUpDown">
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="BorderBrush" Value="#20000000" />
      <Setter Property="MinHeight" Value="32" />
    </Style>

    <!-- Label Style -->
    <Style Selector="TextBlock.label">
      <Setter Property="VerticalAlignment" Value="Center" />
      <Setter Property="Margin" Value="0,0,8,0" />
      <Setter Property="FontWeight" Value="Medium" />
    </Style>

    <!-- TreeDataGrid Styles -->
    <Style Selector="TreeDataGrid">
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="BorderBrush" Value="#15000000" />
      <Setter Property="CornerRadius" Value="8" />
      <Setter Property="MinHeight" Value="300" />
    </Style>
    <Style Selector="TreeDataGrid TreeDataGridRow:nth-child(2n)">
      <Setter Property="Background" Value="#08000000" />
    </Style>
    <Style Selector="TreeDataGrid TreeDataGridRow:pointerover">
      <Setter Property="Background" Value="#15000000" />
    </Style>
    <Style Selector="TreeDataGrid TreeDataGridRow">
      <Setter Property="ContextMenu">
        <Setter.Value>
          <ContextMenu>
            <MenuItem Header="Filter by Line Range"
                      Command="{Binding $parent[UserControl].((viewModels:DxfViewerViewModel)DataContext).FilterByLineRangeCommand}"
                      CommandParameter="{Binding $parent[TreeDataGridRow].DataContext}">
              <MenuItem.Icon>
                <PathIcon Data="M3 17v2h6v-2H3zM3 5v2h10V5H3zm0 6v2h14v-2H3z" />
              </MenuItem.Icon>
            </MenuItem>
            <MenuItem Header="Filter by Data"
                      Command="{Binding $parent[UserControl].((viewModels:DxfViewerViewModel)DataContext).FilterByDataCommand}"
                      CommandParameter="{Binding $parent[TreeDataGridRow].DataContext}">
              <MenuItem.Icon>
                <PathIcon
                  Data="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />
              </MenuItem.Icon>
            </MenuItem>
            <MenuItem Header="Filter by Code"
                      Command="{Binding $parent[UserControl].((viewModels:DxfViewerViewModel)DataContext).FilterByCodeCommand}"
                      CommandParameter="{Binding $parent[TreeDataGridRow].DataContext}">
              <MenuItem.Icon>
                <PathIcon
                  Data="M14.6,16.6L19.2,12L14.6,7.4L16,6L22,12L16,18L14.6,16.6M9.4,16.6L4.8,12L9.4,7.4L8,6L2,12L8,18L9.4,16.6Z" />
              </MenuItem.Icon>
            </MenuItem>
            <Separator />
            <MenuItem Header="Reset All Filters"
                      Command="{Binding $parent[UserControl].((viewModels:DxfViewerViewModel)DataContext).ResetFiltersCommand}">
              <MenuItem.Icon>
                <PathIcon
                  Data="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z" />
              </MenuItem.Icon>
            </MenuItem>
            <Separator />
            <MenuItem Header="Copy Code + Data"
                      Command="{Binding $parent[UserControl].((viewModels:DxfViewerViewModel)DataContext).CopyCodeAndDataCommand}"
                      CommandParameter="{Binding $parent[TreeDataGridRow].DataContext}">
              <MenuItem.Icon>
                <PathIcon
                  Data="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" />
              </MenuItem.Icon>
            </MenuItem>
            <MenuItem Header="Copy Object Tree"
                      Command="{Binding $parent[UserControl].((viewModels:DxfViewerViewModel)DataContext).CopyObjectTreeCommand}"
                      CommandParameter="{Binding $parent[TreeDataGridRow].DataContext}">
              <MenuItem.Icon>
                <PathIcon
                  Data="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" />
              </MenuItem.Icon>
            </MenuItem>
          </ContextMenu>
        </Setter.Value>
      </Setter>
    </Style>

    <!-- Context Menu Styles -->
    <Style Selector="MenuItem">
      <Setter Property="Padding" Value="12,8" />
      <Setter Property="MinWidth" Value="180" />
    </Style>
  </UserControl.Styles>

  <DockPanel Margin="16">
    <Border Background="White"
            CornerRadius="12"
            BoxShadow="0 2 8 0 #20000000"
            DockPanel.Dock="Top"
            Margin="0,0,0,16">
      <Grid RowDefinitions="Auto,Auto" Margin="16">
        <!-- Top Button Bar -->
        <Grid Grid.Row="0"
              Background="#f8f8f8"
              Margin="0,0,0,16">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>

          <StackPanel Grid.Column="0"
                      Orientation="Horizontal"
                      Spacing="12"
                      Margin="12,8">
            <Button Name="LoadButton"
                    Content="Load DXF"
                    Background="#0078D4"
                    Foreground="White" />
            <TextBlock Name="FileNameBlock"
                       VerticalAlignment="Center"
                       Margin="8,0,0,0" />
          </StackPanel>

          <StackPanel Grid.Column="2"
                      Orientation="Horizontal"
                      Spacing="8"
                      Margin="12,8">
            <Button Name="ExpandAllButton"
                    Content="Expand All"
                    Command="{Binding ExpandAllCommand}" />
            <Button Name="CollapseAllButton"
                    Content="Collapse All"
                    Command="{Binding CollapseAllCommand}" />
          </StackPanel>
        </Grid>

        <!-- Search and Filter Bar -->
        <Grid Grid.Row="1"
              Background="#f8f8f8"
              Margin="0">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>

          <StackPanel Grid.Column="0"
                      Orientation="Horizontal"
                      Margin="12,8"
                      Spacing="16">
            <StackPanel Orientation="Horizontal" Spacing="4">
              <TextBlock Text="Code:" Classes="label" />
              <TextBox Text="{Binding CodeSearch}"
                       Width="120"
                       VerticalAlignment="Center" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Spacing="4">
              <TextBlock Text="Data:" Classes="label" />
              <TextBox Text="{Binding DataSearch}"
                       Width="200"
                       VerticalAlignment="Center" />
            </StackPanel>
          </StackPanel>

          <StackPanel Grid.Column="1"
                      Orientation="Horizontal"
                      Margin="12,8"
                      Spacing="8">
            <TextBlock Text="Line Range:"
                       Classes="label"
                       VerticalAlignment="Center" />
            <NumericUpDown Value="{Binding LineNumberStart}"
                           Width="180"
                           Minimum="1"
                           ClipValueToMinMax="True" />
            <TextBlock Text="â€”"
                       VerticalAlignment="Center"
                       Margin="4,0" />
            <NumericUpDown Value="{Binding LineNumberEnd}"
                           Width="180"
                           Minimum="1"
                           ClipValueToMinMax="True" />
          </StackPanel>

          <Button Grid.Column="3"
                  Content="Reset Filters"
                  Command="{Binding ResetFiltersCommand}"
                  Margin="12,8" />
        </Grid>
      </Grid>
    </Border>

    <!-- Main Content Area -->
    <Border Background="White"
            CornerRadius="12"
            BoxShadow="0 2 8 0 #20000000">
      <Grid Margin="16">
        <TreeDataGrid Name="DxfTree"
                      Source="{Binding Source}" />

        <TextBlock Name="PlaceholderText"
                   Text="No DXF file loaded. Click 'Load DXF' to begin."
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   IsVisible="{Binding !HasLoadedFile}"
                   Opacity="0.5"
                   FontSize="16" />
      </Grid>
    </Border>
  </DockPanel>
</UserControl>
